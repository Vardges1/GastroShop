# Руководство администратора GastroShop

## Вход в админ-панель

**Учетные данные администратора:**
- Email: `admin@gastroshop.com`
- Пароль: `Admin123!`

⚠️ **Важно:** В продакшене обязательно измените пароль администратора!

## Доступ к админ-панели

1. Перейдите на страницу `/admin`
2. Если вы не авторизованы, система перенаправит вас на главную страницу
3. Войдите с учетными данными администратора через API `/api/auth/login`

## Функционал админ-панели

### 1. Управление товарами

#### Просмотр всех товаров
- Список всех товаров с информацией о:
  - ID товара
  - Названии и slug
  - Цене
  - Количестве на складе
  - Статусе наличия

#### Добавление нового товара
1. Нажмите кнопку "+ Добавить товар"
2. Заполните форму:
   - **Slug** (обязательно) - уникальный идентификатор товара
   - **Название** (обязательно)
   - **Описание** (опционально)
   - **Цена** в рублях (обязательно)
   - **Количество** (обязательно)
   - **Теги** через запятую (опционально)
   - **Код региона** для карты (опционально)
   - **Изображения** - пути к файлам через запятую (опционально)

#### Редактирование товара
1. Нажмите "Редактировать" рядом с товаром
2. Измените нужные поля
3. Нажмите "Сохранить"

#### Изменение количества товара
1. Нажмите "Изменить" в колонке "Количество"
2. Введите новое количество
3. Нажмите ✓ для сохранения или ✕ для отмены

#### Изменение цены товара
1. Нажмите "Изменить" в колонке "Цена"
2. Введите новую цену в рублях
3. Цена будет обновлена автоматически

#### Удаление товара
1. Нажмите "Удалить" рядом с товаром
2. Подтвердите удаление
3. Товар будет помечен как недоступный (количество = 0)

### 2. Автоматическое управление количеством

Система автоматически уменьшает количество товаров при успешной оплате заказа:
- Когда клиент создает заказ, система проверяет наличие товара
- При успешной оплате количество товара автоматически уменьшается на количество в заказе
- Если количество достигает 0, товар автоматически помечается как "Нет в наличии"

### 3. Просмотр заказов

Функционал просмотра всех заказов будет добавлен в будущих версиях.

## API эндпоинты для админа

Все админ-эндпоинты требуют:
1. Авторизации (Bearer token)
2. Роли "admin"

### Товары

- `GET /api/admin/products` - получить список товаров
- `GET /api/admin/products/:id` - получить товар по ID
- `POST /api/admin/products` - создать товар
- `PUT /api/admin/products/:id` - обновить товар
- `PATCH /api/admin/products/:id/quantity` - изменить количество
- `DELETE /api/admin/products/:id` - удалить товар

### Заказы

- `GET /api/admin/orders` - получить все заказы (в разработке)

## Безопасность

1. Все админ-эндпоинты защищены middleware проверки роли
2. Только пользователи с ролью "admin" могут получить доступ
3. Рекомендуется использовать HTTPS в продакшене
4. Регулярно меняйте пароль администратора

## Миграции базы данных

Для применения изменений выполните миграции:

```bash
cd apps/api
# Применение миграций
migrate -path ./migrations -database "postgres://..." up

# Или используйте встроенный механизм миграций при запуске API
```

Миграции добавляют:
- Поле `quantity` в таблицу `products`
- Администратора по умолчанию

## Устранение неполадок

### Не могу войти в админ-панель
1. Проверьте, что вы используете правильные учетные данные
2. Убедитесь, что пользователь имеет роль "admin" в базе данных
3. Проверьте, что токен авторизации валиден

### Товары не обновляются
1. Проверьте консоль браузера на наличие ошибок
2. Убедитесь, что API сервер запущен
3. Проверьте права доступа в базе данных

### Количество не уменьшается при заказе
1. Проверьте, что webhook платежа обрабатывается корректно
2. Убедитесь, что заказ имеет статус "paid"
3. Проверьте логи API сервера



















