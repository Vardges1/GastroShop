# Настройка авторизации и регистрации

## Проблема

Если вы видите ошибку:
```
ERROR: relation "refresh_tokens" does not exist
```

Это означает, что миграция базы данных для таблицы `refresh_tokens` не была выполнена.

## Решение

### ✅ Исправлено автоматически

В файле `docker-compose.yml` уже исправлена настройка: `SKIP_MIGRATIONS` теперь по умолчанию `false`.

### Быстрое решение (1 команда)

Перезапустите контейнер API, чтобы миграции выполнились автоматически:

```bash
docker-compose restart api
```

Или если это не помогло, пересоберите и запустите заново:

```bash
docker-compose down
docker-compose up -d --build
```

### Альтернативный способ

Если нужно запустить миграцию вручную внутри контейнера:

```bash
# Зайдите в контейнер
docker exec -it gastroshop-api-1 sh

# Миграции должны выполниться автоматически при запуске API
# Но если нужно, можно использовать migrate напрямую (если установлен)
```

### Если проблема сохраняется

1. Проверьте логи API:
```bash
docker-compose logs api | grep migration
```

2. Убедитесь, что файл миграции скопирован в контейнер:
```bash
docker exec gastroshop-api-1 ls -la migrations/ | grep refresh_tokens
```

3. Если файла нет, пересоберите образ:
```bash
docker-compose build api
docker-compose up -d api
```

## Проверка успешного выполнения

После запуска миграции в логах API вы должны увидеть:
```
Database migrations completed successfully
```

И в логах базы данных не должно быть ошибок о несуществующей таблице `refresh_tokens`.

## Что было добавлено

1. **Таблица `refresh_tokens`** - хранит refresh токены пользователей
2. **Новые endpoints:**
   - `POST /api/auth/register` - регистрация (теперь возвращает токены)
   - `POST /api/auth/login` - вход
   - `POST /api/auth/refresh` - обновление токенов
   - `POST /api/auth/logout` - выход
   - `GET /api/auth/me` - получение информации о текущем пользователе

3. **Улучшенная валидация:**
   - Email должен быть валидным форматом
   - Пароль: минимум 8 символов, должен содержать буквы и цифры

4. **Безопасность:**
   - Refresh токены хранятся в БД и могут быть отозваны
   - Токены ротируются при обновлении
   - Поддержка выхода из всех устройств

